{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Book a Ride | JoTravels UK</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #f8f9fa;
    }

    .form-container {
      max-width: 500px;
      margin: 80px auto;
      padding: 30px;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    .btn-whatsapp {
      color: #25d366;
      font-weight: 600;
      text-decoration: none;
    }
  </style>
</head>
<body>

<div class="form-container">
  <h3 class="text-center mb-4">Book Your Airport Transfer</h3>

  <form method="POST">
    {% csrf_token %}
    <div class="mb-3">
      <label class="form-label">Full Name</label>
      <input type="text" name="name" class="form-control" required>
    </div>

    <div class="mb-3">
      <label class="form-label">Pickup Location</label>
      <input type="text" name="pickup" class="form-control" placeholder="e.g., Nottingham City Centre" required>
    </div>

    <div class="mb-3">
      <label class="form-label">Drop Location (Airport)</label>
      <input type="text" name="drop" class="form-control" placeholder="e.g., Heathrow Airport" required>
    </div>

    <div class="mb-3">
  <label class="form-label">Date & Time</label>
  <input type="datetime-local" name="date_time" id="bookingDateTime" class="form-control" required>
</div>


    <div class="mb-3">
      <label class="form-label">Phone Number</label>
      <input type="tel" name="phone" class="form-control" placeholder="+44 7..." required>
    </div>

    <button type="submit" class="btn btn-success w-100">Submit Booking Request</button>
  </form>

  {% if success %}
<div class="alert alert-success mt-3 text-center">
  âœ… Thank you {{ request.POST.name }}! Your booking request has been submitted.<br>
  <a href="{{ whatsapp_link }}" class="btn btn-success mt-2" target="_blank">
    ðŸ’¬ Send Details on WhatsApp
  </a>
</div>
{% endif %}


  <p class="text-center mt-3">
    Prefer WhatsApp? <a href="#" id="whatsappLink" class="btn-whatsapp">Click here to message us.</a>
  </p>
</div>


<script>
document.addEventListener("DOMContentLoaded", function() {
  // âœ… Prevent past date/time selection
  const dateInput = document.getElementById("bookingDateTime");
  const now = new Date();
  now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
  const localNow = now.toISOString().slice(0, 16);
  dateInput.min = localNow;

  // âœ… WhatsApp send link
  const whatsappLink = document.getElementById("whatsappLink");
  whatsappLink.addEventListener("click", function(event) {
    event.preventDefault();

    const name = document.querySelector("input[name='name']").value.trim() || "N/A";
    const pickup = document.querySelector("input[name='pickup']").value.trim() || "N/A";
    const drop = document.querySelector("input[name='drop']").value.trim() || "N/A";
    const phone = document.querySelector("input[name='phone']").value.trim() || "N/A";
    const dateValue = dateInput.value; // <== direct reference

    console.log("ðŸ•“ Raw date input:", dateValue);

    // âœ… Format the datetime if exists
    let formattedDate = "N/A";
    if (dateValue) {
      const dt = new Date(dateValue);
      formattedDate = dt.toLocaleString("en-GB", {
        dateStyle: "medium",
        timeStyle: "short"
      });
    }

    console.log("âœ… Formatted date:", formattedDate);

    // âœ… Build WhatsApp message
    const message =
      `ðŸš– JoTravels UK Booking Request:%0A` +
      `Name: ${name}%0A` +
      `Pickup: ${pickup}%0A` +
      `Drop: ${drop}%0A` +
      `Date & Time: ${formattedDate}%0A` +
      `Phone: ${phone}`;

    const whatsappNumber = "{{ whatsapp_number }}";
    const whatsappURL = `https://wa.me/${whatsappNumber}?text=${message}`;

    // âœ… Debug preview
    console.log("ðŸ“© Final WhatsApp message:", message);

    window.open(whatsappURL, "_blank");
  });
});
</script>


</body>
</html>
